<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ride Hailing App</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: #121212;
    color: #fff;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  input, select {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border: none;
    border-radius: 8px;
    font-size: 15px;
  }

  button {
    width: 100%;
    padding: 14px;
    margin-top: 12px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
  }

  button.confirm { background: #2ecc71; color: white; }
  button.historyBtn { background: #2ecc71; position: absolute; top: 16px; right:16px; border-radius:20px; padding:10px 14px; }

  /* Login / Signup */
  #loginScreen, #signupScreen {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    flex: 1;
    padding: 16px;
  }
  .card {
    background: #1c1c1c;
    border-radius: 16px;
    padding: 20px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  }

  /* Map */
  #map { flex: 1; }

  /* Booking card */
  #bookingCard {
    background: #1c1c1c;
    border-radius: 16px 16px 0 0;
    padding: 20px;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.5);
  }

  #confirmationMessage { margin-top: 12px; color: #2ecc71; font-weight: bold; }

  /* History drawer */
  #historyDrawer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    max-height: 60%;
    background: #1c1c1c;
    border-radius: 16px 16px 0 0;
    padding: 16px;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.5);
    transform: translateY(100%);
    transition: transform 0.3s ease-in-out;
    overflow-y: auto;
  }
  .history-card {
    background: #2a2a2a;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 10px;
    color: #eee;
  }
</style>
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen" class="card">
  <h2>Login</h2>
  <input type="text" id="loginEmail" placeholder="Email or Phone">
  <input type="password" id="loginPassword" placeholder="Password">
  <button id="loginBtn" class="confirm">Login</button>
  <p style="margin-top:12px; text-align:center;">No account? <span id="goSignup" style="color:#2ecc71; cursor:pointer;">Sign up</span></p>
  <p id="loginError" style="color:#e74c3c;"></p>
</div>

<!-- Signup Screen -->
<div id="signupScreen" class="card" style="display:none;">
  <h2>Sign Up</h2>
  <input type="text" id="signupEmail" placeholder="Email or Phone">
  <input type="password" id="signupPassword" placeholder="Password">
  <input type="text" id="signupName" placeholder="Your Name">
  <button id="signupBtn" class="confirm">Sign Up</button>
  <p style="margin-top:12px; text-align:center;">Already have an account? <span id="goLogin" style="color:#2ecc71; cursor:pointer;">Login</span></p>
  <p id="signupError" style="color:#e74c3c;"></p>
</div>

<!-- Map -->
<div id="map" style="display:none;"></div>

<!-- Bottom booking card -->
<div id="bookingCard" style="display:none;">
  <h2>Book a Ride</h2>
  <form id="rideForm">
    <input type="text" id="name" placeholder="Your name" required>
    <input type="text" id="pickup" placeholder="Pickup location" required>
    <input type="text" id="dropoff" placeholder="Drop-off location" required>
    <select id="rideType" required>
      <option value="Standard">Standard</option>
      <option value="Taxi">Taxi</option>
      <option value="Premium">Premium</option>
    </select>
    <button type="submit" class="confirm">Confirm Ride</button>
  </form>
  <p id="confirmationMessage"></p>
</div>

<!-- Ride History Drawer -->
<div id="historyDrawer">
  <h3>Your Ride History</h3>
  <div id="rideHistoryList"></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // ===== Account Management =====
  const loginScreen = document.getElementById("loginScreen");
  const signupScreen = document.getElementById("signupScreen");
  const mapScreen = document.getElementById("map");
  const bookingCard = document.getElementById("bookingCard");

  const loginBtn = document.getElementById("loginBtn");
  const signupBtn = document.getElementById("signupBtn");
  const goSignup = document.getElementById("goSignup");
  const goLogin = document.getElementById("goLogin");

  const loginEmail = document.getElementById("loginEmail");
  const loginPassword = document.getElementById("loginPassword");
  const loginError = document.getElementById("loginError");

  const signupEmail = document.getElementById("signupEmail");
  const signupPassword = document.getElementById("signupPassword");
  const signupName = document.getElementById("signupName");
  const signupError = document.getElementById("signupError");

  goSignup.onclick = () => { loginScreen.style.display="none"; signupScreen.style.display="flex"; };
  goLogin.onclick = () => { signupScreen.style.display="none"; loginScreen.style.display="flex"; };

  signupBtn.addEventListener("click", e => {
    e.preventDefault();
    const email = signupEmail.value.trim();
    const password = signupPassword.value;
    const name = signupName.value.trim();
    if(!email || !password || !name){ signupError.textContent="All fields required"; return; }
    let users = JSON.parse(localStorage.getItem("users")||"{}");
    if(users[email]){ signupError.textContent="User already exists"; return; }
    users[email] = { password, name };
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("currentUser", email);
    loadMapUI(name);
  });

  loginBtn.addEventListener("click", e => {
    e.preventDefault();
    const email = loginEmail.value.trim();
    const password = loginPassword.value;
    let users = JSON.parse(localStorage.getItem("users")||"{}");
    if(!users[email] || users[email].password!==password){ loginError.textContent="Invalid login"; return; }
    localStorage.setItem("currentUser", email);
    loadMapUI(users[email].name);
  });

  const currentUserEmail = localStorage.getItem("currentUser");
  if(currentUserEmail){
    const users = JSON.parse(localStorage.getItem("users")||"{}");
    if(users[currentUserEmail]) loadMapUI(users[currentUserEmail].name);
  }

  function loadMapUI(name){
    loginScreen.style.display="none";
    signupScreen.style.display="none";
    mapScreen.style.display="block";
    bookingCard.style.display="block";
    document.getElementById("name").value = name;

    // Initialize map
    if(!window.map){
      window.map = L.map('map').setView([5.6037, -0.1870], 13); // Accra coordinates
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(window.map);
    }

    loadHistory();
  }

  // ===== Ride Booking & History =====
  const rideForm = document.getElementById("rideForm");
  const confirmation = document.getElementById("confirmationMessage");
  const historyDrawer = document.getElementById("historyDrawer");
  const historyBtn = document.getElementById("historyBtn");
  const rideHistoryList = document.getElementById("rideHistoryList");

  let rideHistory = JSON.parse(localStorage.getItem("rideHistory")||"{}");
  const currentUser = localStorage.getItem("currentUser");
  if(!rideHistory[currentUser]) rideHistory[currentUser]=[];

  function loadHistory(){
    rideHistoryList.innerHTML="";
    const arr = rideHistory[currentUser];
    arr.forEach(ride=>{
      const el = document.createElement("div");
      el.className="history-card";
      el.innerHTML=`<strong>${ride.rideType}</strong><br>${ride.pickup} → ${ride.dropoff}<br>
      <small>${ride.driver} • ${ride.car} • ${ride.plate} • ${ride.arrivalTime} mins</small>`;
      rideHistoryList.appendChild(el);
    });
  }

  historyBtn.addEventListener("click", ()=>{
    if(historyDrawer.style.transform==="translateY(0%)"){
      historyDrawer.style.transform="translateY(100%)";
    } else {
      historyDrawer.style.transform="translateY(0%)";
      loadHistory();
    }
  });

  rideForm.addEventListener("submit", (event)=>{
    event.preventDefault();
    const name = document.getElementById("name").value;
    const pickup = document.getElementById("pickup").value;
    const dropoff = document.getElementById("dropoff").value;
    const rideType = document.getElementById("rideType").value;

    const drivers = ["Kwame","Ama","Yaw","Akosua","Kojo"];
    const cars = ["Toyota Corolla","Hyundai Accent","Kia Rio","Nissan Versa","Honda Civic"];
    const plates = ["GX-1234-24","AS-5678-23","GR-9101-22","BA-3456-21","ER-7890-20"];

    const driver = drivers[Math.floor(Math.random()*drivers.length)];
    const car = cars[Math.floor(Math.random()*cars.length)];
    const plate = plates[Math.floor(Math.random()*plates.length)];
    const arrivalTime = Math.floor(Math.random()*9)+2;

    const ride = {name,pickup,dropoff,rideType,driver,car,plate,arrivalTime};
    rideHistory[currentUser].push(ride);
    localStorage.setItem("rideHistory", JSON.stringify(rideHistory));
    confirmation.textContent=`✅ Hi ${name}, your ${rideType} ride is confirmed! ${driver} is arriving in ${arrivalTime} mins driving a ${car} (${plate}).`;
    rideForm.reset();
    document.getElementById("name").value = name; // refill name
    loadHistory();
  });
</script>
</body>
</html>
